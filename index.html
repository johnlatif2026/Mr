<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>موقع المُدرس</title>
  <style>
    body{font-family:system-ui,Arial;max-width:900px;margin:24px auto;padding:0 16px;line-height:1.7}
    header{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
    img{width:140px;height:140px;object-fit:cover;border-radius:18px;border:1px solid #ddd}
    .card{border:1px solid #e5e5e5;border-radius:16px;padding:16px;margin:14px 0}
    label{display:block;margin-top:10px}
    input,textarea{width:100%;padding:10px;border-radius:12px;border:1px solid #ddd}
    button{padding:10px 14px;border-radius:12px;border:0;background:#111;color:#fff;cursor:pointer;margin-top:10px}
    small{color:#666}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:700px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="card">
    <img id="coachPhoto" alt="صورة المستر" />
    <div>
      <h1 id="coachName">...</h1>
      <p id="coachBio">...</p>
      <p><b>المكان:</b> <span id="coachPlace">...</span></p>
      <p><b>الهاتف:</b> <span id="coachPhone">...</span></p>
      <p><b>السن:</b> <span id="coachAge">...</span></p>
      <p><small><a href="/login.html">تسجيل دخول الأدمن</a></small></p>
    </div>
  </header>

  <section class="card">
    <h2>المواعيد</h2>
    <div id="schedule">...</div>
  </section>

  <section class="card">
    <h2>ابعت طلب / استفسار</h2>
    <form id="inquiryForm">
      <div class="row">
        <div>
          <label>الاسم</label>
          <input name="name" required />
        </div>
        <div>
          <label>الإيميل</label>
          <input name="email" type="email" required />
        </div>
      </div>
      <label>رقم الموبايل (اختياري)</label>
      <input name="phone" />
      <label>الرسالة</label>
      <textarea name="message" rows="5" required></textarea>
      <button type="submit">إرسال</button>
      <p id="status"></p>
    </form>
  </section>

  <script>
    async function loadPublic() {
      const [pRes, sRes] = await Promise.all([
        fetch("/api/public/profile"),
        fetch("/api/public/schedule"),
      ]);
      const profile = await pRes.json();
      const schedule = await sRes.json();

      document.getElementById("coachName").textContent = profile.name || "—";
      document.getElementById("coachBio").textContent = profile.bio || "";
      document.getElementById("coachPlace").textContent = profile.place || "—";
      document.getElementById("coachPhone").textContent = profile.phone || "—";
      document.getElementById("coachAge").textContent = profile.age ?? "—";
      document.getElementById("coachPhoto").src = profile.photoUrl || "https://via.placeholder.com/300?text=Coach";

      const wrap = document.getElementById("schedule");
      wrap.innerHTML = "";
      if (!Array.isArray(schedule.items) || schedule.items.length === 0) {
        wrap.textContent = "لا توجد مواعيد حالياً.";
        return;
      }
      schedule.items.forEach(it => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<b>${it.day}</b> — ${it.time}<br><small>${it.location || ""}</small>`;
        wrap.appendChild(div);
      });
    }

    document.getElementById("inquiryForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const payload = Object.fromEntries(fd.entries());

      const status = document.getElementById("status");
      status.textContent = "جاري الإرسال...";
      try {
        const res = await fetch("/api/public/inquiry", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data?.error || "فشل الإرسال");
        status.textContent = "تم الإرسال ✅";
        e.target.reset();
      } catch (err) {
        status.textContent = "حصل خطأ: " + err.message;
      }
    });

    loadPublic();
  </script>
</body>
</html>
